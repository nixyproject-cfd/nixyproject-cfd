<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SMP</title>
<script src="live2d.min.js"></script>
</head>
<form class="label" action="/server/reg.php" method="post">
<center>
    <div class="kotak_login">
    <h1>Register</h1>
    <br>
    <label for="room" class="label"></label>
    <input type="email" name="user" class="form_login" placeholder="Username" required autofocus>
    <label for="pass" class="form_login"></label>
    <input type="password" name="pass" class="form_login" placeholder="password" required>
    <label for="passed" class="form_login"></label>
    <input type="password" name="passed" class="form_login" placeholder="Confirm Password" required>
    <p>Anda sudah login? <a href="index.php">klick</a> untuk login</p>
    <button class="tombol_login" type="submit">Login</button>

    <p class="mt-5 mb-3 text-muted">batukarut & pagelaran; Terminal.</p>
    </div>
    </div>
</form>
<script>
/*
 * _(:з」∠)_
 * Created by Shuqiao Zhang in 2019.
 * https://zhangshuqiao.org
 */

/*
 * This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 */
window.addEventListener("load", () => {
    "use strict";

    if (!CSS.supports("clip-path", "circle(120px at center)")) {
        document.getElementById("stage").innerHTML = '<img src="../assets/screenshot-1.png">';
        return;
    }

    const apiPath = "https://live2d.fghrsh.net/api";
    let state = 0, loading = false,
        modelId = localStorage.getItem("modelId"),
        modelTexturesId = localStorage.getItem("modelTexturesId");
    if (modelId === null) {
        modelId = 1;
        modelTexturesId = 53;
    }
    loadModel(modelId, modelTexturesId);

    function loadModel(modelId, modelTexturesId) {
        localStorage.setItem("modelId", modelId);
        if (modelTexturesId === undefined) modelTexturesId = 0;
        localStorage.setItem("modelTexturesId", modelTexturesId);
        loadlive2d("live2d", `${apiPath}/get/?id=${modelId}-${modelTexturesId}`, null);
        console.log("live2d", `Model ${modelId}-${modelTexturesId} is loaded.`);
        setTimeout(() => {
            coverPosition("80%");
            state = 2;
        }, 2000);
    }

    function loadRandModel() {
        const modelId = localStorage.getItem("modelId"),
            modelTexturesId = localStorage.getItem("modelTexturesId");
        fetch(`${apiPath}/rand_textures/?id=${modelId}-${modelTexturesId}`)
            .then(response => response.json())
            .then(result => {
                loadModel(modelId, result.textures.id);
                setTimeout(() => {
                    state = 2;
                    coverPosition("80%");
                    loading = false;
                }, 1000);
            });
    }

    function loadOtherModel() {
        const modelId = localStorage.getItem("modelId");
        fetch(`${apiPath}/switch/?id=${modelId}`)
            .then(response => response.json())
            .then(result => {
                loadModel(result.model.id);
            });
    }

    function coverPosition(pos) {
        document.getElementById("cover").style.bottom = pos;
    }

    document.getElementById("info").addEventListener("click", () => {
        fetch("https://v1.hitokoto.cn")
            .then(response => response.json())
            .then(result => {
                alert("「" + result.hitokoto + "」——" + result.from);
            });
    });

    document.getElementById("refresh").addEventListener("click", () => {
        if (loading) return;
        state = 0;
        coverPosition("10%");
        loading = true;
        setTimeout(loadRandModel, 1000);
    });

    document.getElementById("handle").addEventListener("click", () => {
        if (state === 1) {
            state = 2;
            coverPosition("80%");
        }
        else if (state === 2) {
            state = 1;
            coverPosition("20%");
        }
    });

    document.querySelector("input[type=password]").addEventListener("focus", () => {
        if (state === 2) {
            state = 1;
            coverPosition("20%");
        }
    });
    document.querySelector("input[type=password]").addEventListener("blur", () => {
        if (state === 1) {
            state = 2;
            coverPosition("80%");
        }
    });
});
</script>
</body>
</html>